@inherits LayoutComponentBase
@using MudBlazor
@using QLN.Web.Shared.Components.FooterFolder
@inject NavigationManager NavManager
@inject UserState UserState
@inject ISnackbar Snackbar

<MudThemeProvider />
<MudDialogProvider />
<MudPopoverProvider />
<MudSnackbarProvider Position="SnackbarPosition.BottomLeft" />


<header class="site-header mud-elevation-1">
    <div class="header-left">
        <NavLink href="/">
            <MudImage Src="/images/logo.png" Alt="Qatar Living" Height="30" />
        </NavLink>
    </div>

    <nav class="nav-links">
        <NavLink href="/more-features-coming-soon" style="color: white;" class="nav-link">Daily</NavLink>
        <NavLink href="/more-features-coming-soon" style="color: white;" class="nav-link">Properties</NavLink>
        <NavLink href="/more-features-coming-soon" style="color: white;" class="nav-link">Vehicles</NavLink>
        <NavLink href="/classifieds" style="color: white;" class="nav-link active">Classifieds</NavLink>
        <NavLink href="/more-features-coming-soon" style="color: white;" class="nav-link">Services</NavLink>
        <NavLink href="/more-features-coming-soon" style="color: white;" class="nav-link">Jobs</NavLink>
        <NavLink href="/more-features-coming-soon" style="color: white;" class="nav-link">Rewards</NavLink>
       <MudButton Variant="Variant.Filled" Style="background-color: #FF7F38; color: white;" Size="Size.Small" StartIcon="@Icons.Material.Filled.Add" Class="post-ad-btn">
            Post
        </MudButton>
    </nav>

    <div class="header-right">
 

  <MudAvatar Size="Size.Medium" Style="background-color: #E8F2FE;">
                <img src="/images/header/favourite_icon.svg" alt="Account" style="width: 70%; height: 70%; padding: 4px;" />
            </MudAvatar>
        <MudMenu OffsetY="true" AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
           <ActivatorContent>
        <div style="display: flex; align-items: center; gap: 0.5rem;" class="cursor-pointer">
        @if (UserState.IsLoggedIn)
        {
            @if (!string.IsNullOrEmpty(UserState.ProfileImageUrl))
            {
                <MudAvatar Size="Size.Medium" Img="@UserState.ProfileImageUrl" />
            }
            else
            {
               <MudAvatar Size="Size.Medium" Style="background-color: #D6E8F2;">
                <img src="/images/header/account.svg" alt="Account" style="width: 70%; height: 70%; padding: 4px;" />
            </MudAvatar>
            }

            <span class="user-name">
                @((UserState.username?.Length > 10) ? UserState.username.Substring(0, 10) + "..." : UserState.username)
            </span>
        }
        else
        {
            <MudAvatar Size="Size.Medium" Style="background-color: #E8F2FE;">
                <img src="/images/header/account.svg" alt="Account" style="width: 70%; height: 70%; padding: 4px;" />
            </MudAvatar>

        }
    </div>
</ActivatorContent>


            <ChildContent>
                @if (UserState.IsLoggedIn)
                {
                    <MudButton Variant="Variant.Outlined"
                               Color="Color.Warning"
                               StartIcon="@Icons.Material.Filled.AccountCircle"
                                Style="margin: 8px 12px 8px 12px; color: #ff7b00; border-color: #ff7b00; width: calc(100% - 24px); font-weight: bold;"
                               OnClick="@GoToProfile">
                        My Profile
                    </MudButton>

                    <MudButton Variant="Variant.Filled"
                               Color="Color.Warning"
                               StartIcon="@Icons.Material.Filled.Logout"
                               Style="margin: 8px 12px; background-color: #ff7b00; color: white; width: calc(100% - 24px); font-weight: bold;"
                               OnClick="@Logout">
                        Logout
                    </MudButton>
                }
                else
                {
                    <MudButton Variant="Variant.Outlined"
                               Color="Color.Warning"
                               StartIcon="@Icons.Material.Filled.Login"
                               Style="margin: 8px 12px 8px 12px; color: #ff7b00; border-color: #ff7b00; width: calc(100% - 24px); font-weight: bold;"
                               OnClick="@(() => NavManager.NavigateTo("/login"))">
                        Login
                    </MudButton>

                    <MudButton Variant="Variant.Filled"
                               Color="Color.Warning"
                               StartIcon="@Icons.Material.Filled.PersonAdd"
                               Style="margin: 8px 12px; background-color: #ff7b00; color: white; width: calc(100% - 24px); font-weight: bold;"
                               OnClick="@(() => NavManager.NavigateTo("/signup"))">
                        Sign Up
                    </MudButton>
                }
            </ChildContent>
        </MudMenu>
    </div>
</header>

<main class="main-content">
    @Body
    <Footer />
</main>

@code {
    private void GoToProfile()
    {
        NavManager.NavigateTo("/profilePage"); 
    }

    private void Logout()
    {
        UserState.Email = null;
        UserState.Token = null;
        Snackbar.Add("Logged out successfully", Severity.Info);
        NavManager.NavigateTo("/");
    }
}
