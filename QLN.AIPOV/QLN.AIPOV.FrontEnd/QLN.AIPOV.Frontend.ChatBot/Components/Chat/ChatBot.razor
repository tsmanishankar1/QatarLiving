<MudGrid>
    <MudItem sm="12" md="12">
        @if (_isLoading)
        {
            <MudProgressLinear Indeterminate="true" Color="Color.Primary" Class="my-2" />
        }
        <MessageInput OnSend="SendMessageAsync" DisableChatInput="_isLoading" />
    </MudItem>
    <MudItem sm="12" md="12">
        <div class="description-container">
            <!-- Custom header with copy button -->
            <div class="description-header">
                <MudText Typo="Typo.subtitle1">Job Description</MudText>
                <MudIconButton Icon="@Icons.Material.Filled.ContentCopy"
                               Size="Size.Small"
                               OnClick="@(() => CopyToClipboard(Description))"
                               Title="Copy to clipboard" />
            </div>

            @if (SelectedJobDescription != null)
            {
                <MudCard Elevation="0" Class="job-description-card">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h6" Color="Color.Primary">@SelectedJobDescription.JobTitle</MudText>
                        </CardHeaderContent>
                    </MudCardHeader>

                    <MudCardContent>
                        <MudGrid>
                            @if (!string.IsNullOrEmpty(SelectedJobDescription.JobPurpose))
                            {
                                <MudItem xs="12">
                                    <MudText Typo="Typo.subtitle1" Color="Color.Primary">Job Purpose</MudText>
                                    <MudText Typo="Typo.body1" Class="mt-1 mb-3">@SelectedJobDescription.JobPurpose</MudText>
                                </MudItem>
                            }

                            @if (!string.IsNullOrEmpty(SelectedJobDescription.JobDutiesAndResponsibilities))
                            {
                                <MudItem xs="12">
                                    <MudText Typo="Typo.subtitle1" Color="Color.Primary">Duties & Responsibilities</MudText>
                                    <MudText Typo="Typo.body1" Class="mt-1 mb-3 job-text">@SelectedJobDescription.JobDutiesAndResponsibilities</MudText>
                                </MudItem>
                            }

                            <MudItem xs="12" md="6">
                                @if (!string.IsNullOrEmpty(SelectedJobDescription.RequiredQualifications))
                                {
                                    <MudPaper Elevation="0" Class="pa-3 mb-3 mud-background-gray rounded-lg">
                                        <MudText Typo="Typo.subtitle1" Color="Color.Primary">
                                            <MudIcon Icon="@Icons.Material.Filled.Check" Size="Size.Small" Class="mr-1" /> Required Qualifications
                                        </MudText>
                                        <MudText Typo="Typo.body1" Class="mt-2 job-text">@SelectedJobDescription.RequiredQualifications</MudText>
                                    </MudPaper>
                                }
                            </MudItem>

                            <MudItem xs="12" md="6">
                                @if (!string.IsNullOrEmpty(SelectedJobDescription.PreferredQualifications))
                                {
                                    <MudPaper Elevation="0" Class="pa-3 mb-3 mud-background-gray rounded-lg">
                                        <MudText Typo="Typo.subtitle1" Color="Color.Primary">
                                            <MudIcon Icon="@Icons.Material.Filled.Star" Size="Size.Small" Class="mr-1" /> Preferred Qualifications
                                        </MudText>
                                        <MudText Typo="Typo.body1" Class="mt-2 job-text">@SelectedJobDescription.PreferredQualifications</MudText>
                                    </MudPaper>
                                }
                            </MudItem>

                            @if (!string.IsNullOrEmpty(SelectedJobDescription.WorkingConditions))
                            {
                                <MudItem xs="12">
                                    <MudText Typo="Typo.subtitle1" Color="Color.Primary">
                                        <MudIcon Icon="@Icons.Material.Filled.LocationOn" Size="Size.Small" Class="mr-1" /> Working Conditions
                                    </MudText>
                                    <MudText Typo="Typo.body1" Class="mt-2 job-text">@SelectedJobDescription.WorkingConditions</MudText>
                                </MudItem>
                            }
                        </MudGrid>
                    </MudCardContent>
                </MudCard>
            }
            else if (!string.IsNullOrEmpty(Description))
            {
                <!-- Fallback to text display when no JobDescription object is available -->
                <MudTextField @bind-Value="Description"
                              Variant="Variant.Text"
                              Lines="20"
                              MinRows="10"
                              MaxRows="1000"
                              AutoGrow
                              Immediate
                              ReadOnly="true"
                              Class="description-text-field borderless-field" />
            }
            else
            {
                <MudAlert Severity="Severity.Info" Class="mt-2">
                    No job description selected. Send a message to get job descriptions.
                </MudAlert>
            }
        </div>
    </MudItem>
</MudGrid>

<style>
    .description-container {
        height: calc(100vh - 11.2rem);
        display: flex;
        flex-direction: column;
        padding: 0;
        overflow: hidden;
    }

    /* Header with copy button */
    .description-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
        padding: 0 4px;
    }

    .job-description-card {
        overflow-y: auto;
        flex: 1;
        background-color: #f8f9fa;
        padding: 8px;
    }

    .job-text {
        white-space: pre-wrap;
    }

    /* Existing styles for the fallback text display */
    .description-text-field {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

        .description-text-field .mud-input-control {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .description-text-field .mud-input-control-input-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .description-text-field .mud-input-slot {
            overflow-y: auto !important;
            padding: 8px;
        }

        .description-text-field .mud-input-text {
            overflow-y: auto !important;
            max-height: 100%;
            padding: 4px;
        }

    .borderless-field .mud-input.mud-input-text {
        border: none !important;
        box-shadow: none !important;
    }

    .borderless-field.mud-text-field {
        background-color: #f8f9fa;
        padding: 8px;
    }

    .borderless-field .mud-input-adornment {
        margin-top: 0;
    }

    .borderless-field .mud-input-underline::before,
    .borderless-field .mud-input-underline::after {
        display: none;
    }

    .description-text-field .mud-input-label {
        display: none;
    }
</style>
