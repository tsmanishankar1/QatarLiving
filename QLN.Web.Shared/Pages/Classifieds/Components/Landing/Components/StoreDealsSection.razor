@using MudBlazor

<div class="store-carousel-wrapper">
    <h3 class="carousel-title">Discover amazing deals from the best stores in Qatar</h3>

    <div class="carousel-container">
        <MudIconButton Icon="@Icons.Material.Filled.ChevronLeft"
                       OnClick="@PrevSlide"
                       Disabled="@IsFirstSlide"
                       Class="custom-arrow-button1 left" />

        <div class="carousel-viewport">
            <div class="carousel-track" style="transform:@TrackOffset">
                @foreach (var store in stores)
                {
                    <div class="store-card">
                        <div class="store-logo-container">
                            <img src="@store.LogoUrl" class="store-logo" alt="@store.Name" />
                        </div>
                        <div class="store-info">
                            <div class="store-name">@store.Name</div>
                            <div class="store-items">@store.ItemCount Items</div>
                            <MudButton Variant="Variant.Text"
                                       Size="Size.Small"
                                       EndIcon="@Icons.Material.Filled.ArrowForward"
                                       Class="shop-now-btn"
                                       OnClick="@(() => HandleShopNow(store))">
                                Shop Now
                            </MudButton>
                        </div>
                    </div>
                }
            </div>
        </div>

        <MudIconButton Icon="@Icons.Material.Filled.ChevronRight"
                       OnClick="@NextSlide"
                       Disabled="@IsLastSlide"
                       Class="custom-arrow-button1 right" />
    </div>
</div>

@code {
    private List<StoreItem> stores = new()
    {
        new StoreItem { Name = "AIRBNB", LogoUrl = "images/stores/vector.svg", ItemCount = "2,152" },
        new StoreItem { Name = "Starlink", LogoUrl = "images/stores/starlink.svg", ItemCount = "2,152" },
        new StoreItem { Name = "MICROSOFT", LogoUrl = "images/stores/microsoft.svg", ItemCount = "2,152" },
        new StoreItem { Name = "Lulu Hypermarket", LogoUrl = "images/stores/hypermarket.svg", ItemCount = "2,152" },
        new StoreItem { Name = "City Hypermarket", LogoUrl = "images/stores/hypermarket_city.svg", ItemCount = "1,845" },
        new StoreItem { Name = "Al Meera", LogoUrl = "images/stores/meera.svg", ItemCount = "3,021" },
        new StoreItem { Name = "MICROSOFT", LogoUrl = "images/stores/microsoft.svg", ItemCount = "2,152" },
        new StoreItem { Name = "Lulu Hypermarket", LogoUrl = "images/stores/hypermarket.svg", ItemCount = "2,152" },
        new StoreItem { Name = "AIRBNB", LogoUrl = "images/stores/vector.svg", ItemCount = "2,152" },
        new StoreItem { Name = "Starlink", LogoUrl = "images/stores/starlink.svg", ItemCount = "2,152" },
        new StoreItem { Name = "Al Meera", LogoUrl = "images/stores/meera.svg", ItemCount = "3,021" },
        new StoreItem { Name = "MICROSOFT", LogoUrl = "images/stores/microsoft.svg", ItemCount = "2,152" },
    };

    private int groupIndex = 0;
    private int itemsPerGroup = 6;
    private int cardWidthPx = 170 + 16;

    private int TotalGroups => (int)Math.Ceiling((double)stores.Count / itemsPerGroup);

    private void NextSlide()
    {
        if (groupIndex < TotalGroups - 1)
            groupIndex++;
    }

    private void PrevSlide()
    {
        if (groupIndex > 0)
            groupIndex--;
    }

    private string TrackOffset => $"translateX(-{groupIndex * cardWidthPx * itemsPerGroup}px)";
    private bool IsFirstSlide => groupIndex == 0;
    private bool IsLastSlide => groupIndex >= TotalGroups - 1;

    private void HandleShopNow(StoreItem store)
    {
        Console.WriteLine($"Shop Now clicked for {store.Name}");
    }

    public class StoreItem
    {
        public string Name { get; set; }
        public string LogoUrl { get; set; }
        public string ItemCount { get; set; }
    }
}

<style>
.store-carousel-wrapper {
    padding: 2rem 1rem;
    position: relative;
    text-align: center;
    font-family: 'Public Sans', sans-serif;
}

.carousel-title {
    font-weight: 600;
    font-size: 25px;
    color: var(--color-text-heading);
    margin-bottom: 1.5rem;
    text-align: center;
}

.carousel-container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.carousel-viewport {
    overflow: hidden;
    width: 100%; /* 6 cards * (200 + 16)px */
}

.carousel-track {
    display: flex;
    padding: 5px;
    transition: transform 0.5s ease-in-out;
    width: fit-content;
}

.store-card {
    width: 170px;
    margin-right: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 5px;
    flex-shrink: 0;
}

.store-logo-container {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background-color: var(--color-background);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
}

.store-logo {
    max-width: 100%;
    max-height: 100%;
    padding: 10px;
    object-fit: contain;
}

.store-info {
    text-align: center;
    font-size: 0.75rem;
}

.store-name {
    font-weight: 600;
    color: var(--color-text-secondary);
}

.store-items {
    font-size: 0.65rem;
    color: var(--color-text-caption);
    margin-bottom: 4px;
}

.shop-now-btn {
    font-size: 0.7rem;
    text-transform: capitalize;
    color: var(--color-accent);
    padding: 0;
    min-height: 0;
}

.custom-arrow-button1 {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    background:  var(--color-background);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.custom-arrow-button1.left {
    left: -20px;
}

.custom-arrow-button1.right {
    right: -20px;
}

@@media (max-width: 768px) {
    .custom-arrow-button1 {
        display: none;
    }

    .carousel-viewport {
        overflow-x: auto;
        scroll-behavior: smooth;
        width: 100%;
    }

    .carousel-track {
        transform: none !important;
        width: max-content;
    }

    .store-card {
        width: 100px;
        margin-right: 12px;
    }
}
</style>
