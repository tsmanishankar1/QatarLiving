@page "/subscription"
@using QLN.Web.Shared.Components.ModalDialog
@using QLN.Web.Shared.Components.BreadCrumb
@using QLN.Web.Shared.Models
@using MudBlazor


@if (_actionSucess){
    <div class="popup-overlay">
        <ModalDialog
        Title="Payment Success!"
        Description="Payment was successful"
        ButtonName="Continue"
        StatusType="Success"
        OnClick="CloseSuccessPopup" />
    </div>
}
<MudContainer MaxWidth="MaxWidth.Large" Class="py-6 px-4" Style="background-color: #F2F4F7;">
    <Breadcrumb Items="breadcrumbItems" />

    <div style="width: 100%;display:flex;justify-content:center;align-items:center;">
        <div style="width: 90%;display:flex;justify-content:center;align-items:center;">
            <div style="text-align: center; margin-bottom: 24px;">
                <MudText Typo="Typo.h5" Class="font-semibold mb-1" Style="color:#242424;">
                    Subscription Packages
                </MudText>
                <MudText Typo="Typo.subtitle1" Class="mb-4" Style="color:#646464;">
                    We offer tailored subscription packages for every need, Whether you're listing a property, selling a vehicle, or promoting a service. Choose a category to get started
                </MudText>
                <div class="vertical-tabs">
                    <div class="vertical-tabs-toolbar">
                        <div class="vertical-tab @( _activeVerticalTabIndex == 0 ? "active" : "" )" @onclick="() => SetVeritcalTab(0)">

                                <img src="/qln-images/subscription/Properties.svg" class="vertical-tab-icon" alt="Deals">
                                <span class="vertical-tab-text">Properties</span>
                            <div class="vertical-tab-indicator"></div>
                        </div>
                        <div class="vertical-tab @( _activeVerticalTabIndex == 1 ? "active" : "" )" @onclick="() => SetVeritcalTab(1)">

                                <img src="/qln-images/subscription/Vehicles.svg" class="vertical-tab-icon" alt="Stores">
                                <span class="vertical-tab-text">Vehicles</span>
                            <div class="vertical-tab-indicator"></div>
                        </div>
                        <div class="vertical-tab @( _activeVerticalTabIndex == 2 ? "active" : "" )" @onclick="() => SetVeritcalTab(2)">

                                <img src="/qln-images/subscription/Classifieds.svg" class="vertical-tab-icon" alt="Preloved">
                                <span class="vertical-tab-text">Classified</span>
                            <div class="vertical-tab-indicator"></div>
                        </div>
                        <div class="vertical-tab @( _activeVerticalTabIndex == 3 ? "active" : "" )" @onclick="() => SetVeritcalTab(3)">

                                <img src="/qln-images/subscription/Services.svg" class="vertical-tab-icon" alt="Preloved">
                                <span class="vertical-tab-text">Services</span>
                            <div class="vertical-tab-indicator"></div>
                        </div>
                        <div class="vertical-tab @( _activeVerticalTabIndex == 4 ? "active" : "" )" @onclick="() => SetVeritcalTab(4)">

                                <img src="/qln-images/subscription/Jobs.svg" class="vertical-tab-icon" alt="Preloved">
                                <span class="vertical-tab-text">Jobs</span>
                            <div class="vertical-tab-indicator"></div>
                        </div>
                        <div class="vertical-tab  @( _activeVerticalTabIndex == 5 ? "active" : "" )" @onclick="() => SetVeritcalTab(5)">

                                <img src="/qln-images/subscription/Rewards.svg" class="vertical-tab-icon" alt="Preloved">
                                <span class="vertical-tab-text">Rewards</span>
                            <div class="vertical-tab-indicator"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <MudGrid GutterSize="4">

        <!-- LEFT SECTION -->
        <MudItem xs="12" md="9">
            <div style="max-width: 800px; margin: 0 auto;">
                 <div style="width: 100%;display:flex;justify-content:center;align-items:center;">
        <div style="width: 90%;display:flex;justify-content:center;align-items:center;">
            <div style="text-align: center; margin-bottom: 24px;">
                <MudText Typo="Typo.h5" Class="font-semibold mb-1" Style="color:#242424;">
                    Classifieds Subscriptions
                </MudText>
                <MudText Typo="Typo.subtitle1" Class="mb-4" Style="color:#646464;">
                    Promote smarter. Sell quicker. Stay visible longer
                </MudText>
              </div></div>
              </div>
                <div class="custom-tabs">
                    <div class="tabs-toolbar">
                        <div class="tab @( _activeTabIndex == 0 ? "active" : "" )" @onclick="() => SetTab(0)">
                            <div style="display:flex;flex-direction:row;gap:10px">

                                <img src="/qln-images/subscription/Deals.svg" class="tab-icon" alt="Deals">
                                <span class="tab-text">Deals</span>
                            </div>
                            <div class="tab-indicator"></div>
                        </div>
                        <div class="tab @( _activeTabIndex == 1 ? "active" : "" )" @onclick="() => SetTab(1)">
                            <div style="display:flex;flex-direction:row;gap:10px">

                                <img src="/qln-images/subscription/Stores.svg" class="tab-icon" alt="Stores">
                                <span class="tab-text">Stores</span>
                            </div>
                            <div class="tab-indicator"></div>
                        </div>
                        <div class="tab @( _activeTabIndex == 2 ? "active" : "" )" @onclick="() => SetTab(2)">
                            <div style="display:flex;flex-direction:row;gap:10px">

                                <img src="/qln-images/subscription/Preloved.svg" class="tab-icon" alt="Preloved">
                                <span class="tab-text">Preloved</span>
                            </div>
                            <div class="tab-indicator"></div>
                        </div>
                    </div>
                </div>


                <MudGrid GutterSize="4" Style="margin-top: 16px;">

                    @if (_isLoadingPlans)
                    {
                        <MudItem xs="12" >
                            <div style="display: flex; justify-content: center; align-items: center; height: 200px; text-align: center;">
                                <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
                            </div>
                        </MudItem>
                    }
                    else if (_isError)
                    {
                        <MudItem xs="12">
                            <div style="display: flex; justify-content: center; align-items: center; height: 200px; text-align: center;">
                                <MudText Color="Color.Error" Typo="Typo.subtitle1">
                                    No subscription plans available at the moment.
                                </MudText>
                            </div>
                        </MudItem>
                    }
                    else if (_plans != null && _plans.Any())
                    {
                        @foreach (var plan in _plans)
                        {
                            <MudItem  xs="12" sm="6" md="4" lg="4">
                                                <div style="height: 100%; display: flex; flex-direction: column;">

                                <SubscriptionCard Plan="plan"
                                                  IsSelected="_selectedPlan?.SubscriptionName == plan.SubscriptionName &&
                                              _selectedPlan?.Price == plan.Price &&
                                              _selectedPlan?.Duration == plan.Duration"
                                                  OnSelect="() => SelectPlan(plan)" />
                                </div>

                            </MudItem>
                        }
                    }
                    else
                    {
                        <MudItem xs="12">
                            <MudText Color="Color.Info" Typo="Typo.subtitle1">
                                No subscription plans available at the moment.
                            </MudText>
                        </MudItem>
                    }

                </MudGrid>

 
            </div>
        </MudItem>

        <!-- RIGHT SECTION -->
        <MudItem xs="12" md="3">
            <!-- Summary Card -->
            <MudPaper   Style="@CardStyle" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-2">Summary</MudText>
                @if (_selectedPlan != null)
                {
                    <MudText>Plan: @_selectedPlan.Duration</MudText>
                    <MudText>Price: @_selectedPlan.Price</MudText>
                }
                else
                {
                    <MudText>No plan selected.</MudText>
                }

                <MudDivider Class="my-2" />
                <MudText Class="font-bold mt-2">Total: @(_selectedPlan?.Price ?? 0)</MudText>

                <MudBox Class="mt-4" Style="width: 100%;display: flex; justify-content:center;align-items:center">
                    <MudButton Disabled="_selectedPlan == null"
                    OnClick="OpenPaymentDialog"
                    Class="font-semibold"
                    Style="@(_selectedPlan == null ?
               "background-color: #E0E0E0; color: white; width: 200px;" :
               "background-color: #F26D1E; color: white; width: 200px;")">
                        Pay Now
                    </MudButton>
                </MudBox>

                @if (_isPaymentDialogOpen)
                {
                    <MudOverlay Visible="true" Style="z-index: 1300; background-color: rgba(0,0,0,0.6);">
                        <div style="display: flex; justify-content: center; align-items: center; height: 100vh;">
                            <MudPaper Elevation="8"
                                      Style="width: 100%; max-width: 480px; background-color: white; border-radius: 16px; padding: 32px;">
                                <MudForm Model="@_model" @ref="_form">

                                <MudStack Spacing="3">
                                    <MudText Typo="Typo.h6" Style="color: #242424;">Card Details</MudText>

                                    <MudTextField T="string"
                                                  Label="Card Number"
                                                  id="cardNumber"
                                                  Variant="Variant.Outlined"
                                                  Placeholder="1234 5678 9012 3456"
                                                  Style="border-radius: 8px;"
                                                      @bind-Value="_model.CardNumber"
                                                      Immediate="true"
                                                      For="@(() => _model.CardNumber)" />

                                    <MudGrid GutterSize="2">
                                        <MudItem xs="6">
                                                <MudTextField T="string"
                                                              Label="Expiry"
                                                              id="expiry"
                                                              Variant="Variant.Outlined"
                                                              Placeholder="MM/YY"
                                                              Style="border-radius: 8px;"
                                                              Immediate="true"
                                                              MaxLength="5"
                                                              @bind-Value="_model.Expiry"
                                                              @bind-Value:event="oninput"
                                                              For="@(() => _model.Expiry)" />
                                        </MudItem>
                                        <MudItem xs="6">
                                            <MudTextField T="string"
                                                          Label="CVV"
                                                              id="cvv"
                                                          Variant="Variant.Outlined"
                                                          Placeholder="123"
                                                              MaxLength="3"
                                                              Style="border-radius: 8px;"
                                                              @bind-Value="_model.CVV"
                                                              Immediate="true"
                                                              For="@(() => _model.CVV)" />
                                        </MudItem>
                                    </MudGrid>

                                    <MudTextField T="string"
                                                  Label="Card Holder Name"
                                                      id="name"
                                                  Variant="Variant.Outlined"
                                                  Placeholder="John Doe"
                                                  Style="border-radius: 8px;"
                                                      @bind-Value="_model.CardHolderName"
                                                      Immediate="true"
                                                      For="@(() => _model.CardHolderName)" />

                                    <MudStack Row Spacing="2" Class="justify-end mt-4">
                                        <MudButton Variant="Variant.Outlined"
                                                       id="cancelBtn"
                                                   Color="Color.Default"
                                                   OnClick="() => _isPaymentDialogOpen = false">
                                            Cancel
                                        </MudButton>

                                        <MudButton id="paymentBtn" Variant="Variant.Filled"
                                                   Style="background-color: #41979a; color: white;"
                                                   OnClick="SubmitMockCardPayment">
                                            Pay ₹@_selectedPlan?.Price
                                        </MudButton>
                                    </MudStack>
                                    <MudText Typo="Typo.body2" Class="text-center mt-4">
                                        GURANTEED SAFE CHECKOUT
                                    </MudText>
                                </MudStack>
                                </MudForm>
                            </MudPaper>
                        </div>
                    </MudOverlay>
              }
            </MudPaper>
        </MudItem>
    </MudGrid>
</MudContainer>




<style>
    .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(120, 120, 120, 1);
        backdrop-filter: blur(8px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
</style>