@page "/qln/community/post/create"
@inherits CommunityPostCreateBase
@using QLN.Web.Shared.Components.BreadCrumb
@using MudExRichTextEditor


<MudContainer MaxWidth="MaxWidth.False" Class="px-4 px-md-12 py-6" Style="background-color: #F5F6FA;">

    <Breadcrumb Items="breadcrumbItems" />

    <div class="community-form-wrapper mx-auto">
        <MudText Typo="Typo.h5" Class="mb-4 community-heading-style ">Post Details</MudText>

        <EditForm EditContext="@editContext"
                  OnValidSubmit="HandleValidSubmit">
            <DataAnnotationsValidator />

            <MudGrid>
                <MudItem xs="12">
                    <MudSelect T="string"
                               @bind-Value="PostModel.CategoryId"
                               Label="Category *"
                               Class="community-select-input no-underline"
                               For="@(() => PostModel.CategoryId)"
                               Immediate="true">
                        @if (Categories?.Any() == true)
                        {
                            @foreach (var category in Categories)
                            {
                                <MudSelectItem Value="@category.Id">@category.Name</MudSelectItem>
                            }
                        }
                    </MudSelect>
                    <ValidationMessage For="@(() => PostModel.CategoryId)" />
                </MudItem>

                <MudItem xs="12">
                    <MudTextField @bind-Value="PostModel.Title"
                                  Label="Title *"
                                  For="@(() => PostModel.Title)"
                                  Class="community-form-input no-underline"
                                  MaxLength="100"
                                  Immediate="true" />
                    <ValidationMessage For="@(() => PostModel.Title)" />

                </MudItem>

                <MudItem xs="12">
                    <MudText Typo="Typo.subtitle1" Class="mb-2">Description *</MudText>
                    <MudExRichTextEdit Value="@PostModel.Description"
                                       ValueChanged="OnDescriptionChanged"
                                       Height="300"
                                       Class="description-input no-underline"
                                       Placeholder="Description..."
                                       Immediate="true" />
                    <ValidationMessage For="@(() => PostModel.Description)" />
                </MudItem>

                <MudItem xs="12" Class="mt-2">

                    <MudText Typo="Typo.h6" Class="community-heading-style">Upload a Photo</MudText>
                </MudItem>

                <MudItem xs="12" Class="mt-2 ">
                    <div style="background-color:white; max-width:470px; width:100%; margin: 0 auto;">

                        <div class="d-flex align-items-start p-2 gap-2 mt-2">
                            <MudIcon Icon="@Icons.Material.Filled.Info" Color="Color.Default" Size="Size.Small" />
                            <MudText Typo="Typo.body2" Class="text-muted">
                                Use landscape orientation (horizontal) for optimal photo display.
                            </MudText>
                        </div>


                        <MudFileUpload T="IBrowserFile" Accept="image/*" FilesChanged="OnLogoFileSelected" MaxFileSize="10485760">
                            <ActivatorContent>
                                <div style="display: flex; justify-content: center; margin-top: 10px;margin-bottom: 10px;">

                                    <MudPaper Elevation="0"
                                              Class="d-flex flex-column align-center justify-center mt-2 p-2"
                                              Style="height: 240px; width:380px;cursor: pointer;background-color: #F5F6FA;  border: 2px dashed #ccc;">
                                        @if (!string.IsNullOrEmpty(ImagePreviewUrl))
                                        {
                                            <img src="@ImagePreviewUrl"
                                                 alt="Post "
                                                 style="max-height: 100%; max-width: 100%; object-fit: contain;" />

                                        }
                                        else
                                        {
                                            <div style="width: 64px; height: 64px;  border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                                <MudIcon Icon="@Icons.Material.Filled.Add" Color="Color.Primary" Size="Size.Medium" />
                                            </div>
                                            <MudText style="margin-top: 8px; color: black; font-size: 14px; font-weight: 500;">Upload</MudText>
                                        }

                                    </MudPaper>
                                </div>
                            </ActivatorContent>
                        </MudFileUpload>
                    </div>
                </MudItem>

                <MudItem xs="12">
                    <MudCheckBox T="bool"
                                 @bind-Checked="AgreedToTerms"
                                 Required="true"
                                 Color="Color.Primary"
                                 Class="community-checkbox-label">
                        <LabelContent>
                            I agree to the <span class="community-terms-highlight">Terms of Use</span> of community posts on Qatar Living.
                        </LabelContent>
                    </MudCheckBox>

                </MudItem>

                <MudItem xs="12" class="mt-4">
                    <MudGrid Class="d-flex" GutterSize="0">
                        <MudItem xs="6">
                            <MudButton Variant="Variant.Outlined"
                                       OnClick="Cancel"
                                       FullWidth="true">
                                Close
                            </MudButton>
                        </MudItem>
                        <MudItem xs="6">
                            <MudButton Class="ml-0"
                                       Variant="Variant.Filled"
                                       Disabled="!AgreedToTerms || IsLoading"
                                       Color="Color.Primary"
                                       ButtonType="ButtonType.Submit"
                                       Loading="@IsLoading"
                                       FullWidth="true">
                                @if (IsLoading)
                                {
                                    <MudProgressCircular Indeterminate="true" Size="Size.Small" Color="Color.Inherit" Class="mr-2" />
                                }
                                Publish
                            </MudButton>
                        </MudItem>
                    </MudGrid>
                </MudItem>

            </MudGrid>
        </EditForm>
    </div>

</MudContainer>


<style>
    
    .no-underline .mud-input-underline::before,
    .no-underline .mud-input-underline::after {
        border-bottom: none !important;
    }

</style>