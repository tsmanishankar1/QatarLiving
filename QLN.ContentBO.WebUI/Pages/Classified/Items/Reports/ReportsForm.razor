@using MudBlazor
@inherits ReportsFormBase

<div class="report-form-container">
    <MudText Typo="Typo.h6" Class="form-title">Report Form</MudText>

    <MudSelect T="string" Label="Category*" Variant="Variant.Outlined" Class="form-field" Required="true" @bind-Value="_selectedCategory">
        @foreach (var category in _categories)
        {
            <MudSelectItem Value="@category">@category</MudSelectItem>
        }
    </MudSelect>

    <MudSelect T="string" Label="Status*" Variant="Variant.Outlined" Class="form-field" Required="true" @bind-Value="_selectedStatus">
        @foreach (var status in _statuses)
        {
            <MudSelectItem Value="@status">@status</MudSelectItem>
        }
    </MudSelect>

    <!-- Date Range Selector -->
    <div class="report-date-input @(showDatePopover ? "active-report" : "")" @onclick="ToggleDatePopover">
           <span class="report-date-placeholder">
            @{
                if (_dateRange.Start.HasValue && _dateRange.End.HasValue)
                {
                    <text>@_dateRange.Start.Value.ToString("dd MMM yyyy") - @_dateRange.End.Value.ToString("dd MMM yyyy")</text>
                }
                else
                {
                    <text>Date Range*</text>
                }
            }
        </span>
        <img src="/qln-images/date_icon.svg" class="report-date-icon @(showDatePopover ? "active-icon" : "")" style="width:16px;" />
        <MudPopover Open="@showDatePopover"
                    AnchorOrigin="Origin.BottomCenter"
                    TransformOrigin="Origin.TopCenter"
                    Elevation="6"
                    Class="popover-container"
                    Style="padding:0;">
            <div class="custom-range-picker-container">
                <!-- Left: Calendar -->
                <div class="range-calendar">
                    <MudDateRangePicker 
                        @bind-DateRange="_tempDateRange"
                        PickerVariant="PickerVariant.Static"
                        DisableToolbar="true"
                        ShowToolbar="false"
                        DisplayMonths="1"
                        Class="event-custom-date-range"
                        Style="min-width: 300px;" 
                    />
                </div>
                <!-- Right: Range Info + Controls -->
                <div class="range-sidebar">
                <div class="range-header-col">
                        <span class="date-value">
                            @( _tempDateRange?.Start?.ToString("dd MMM yyyy") ?? "Start date" )
                        </span>
                        <span class="date-value">
                            @( _tempDateRange?.End?.ToString("dd MMM yyyy") ?? "End date" )
                       </span>
                </div>
                    <div class="range-footer">
                        <MudButton Variant="Variant.Filled" Class="popover-button" OnClick="CancelDatePopover">Cancel</MudButton>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="popover-button" OnClick="ApplyDatePopover">Apply</MudButton>
                    </div>
                </div>
            </div>
        </MudPopover>
    </div>

    <MudSelect T="string" Label="Subcategories" Variant="Variant.Outlined" Class="form-field" @bind-Value="_selectedSubcategory">
        @foreach (var sub in _subcategories)
        {
            <MudSelectItem Value="@sub">@sub</MudSelectItem>
        }
    </MudSelect>

    <MudSelect T="string" Label="Section" Variant="Variant.Outlined" Class="form-field disabled-field" Disabled="true"></MudSelect>
    <MudSelect T="string" Label="More Filters" Variant="Variant.Outlined" Class="form-field disabled-field" Disabled="true"></MudSelect>

    <MudButton Variant="Variant.Filled" Color="Color.Primary"  Class="download-btn" FullWidth="true">
        <img src="/qln-images/upload_white_icon.svg" class="image-upload" width="20" height="20" />
        Download Report
    </MudButton>
</div>

<style>
      .report-form-container {
        display: flex;
        flex-direction: column;
        width: 100%;
        max-width: 480px;
        padding: 10px;
        font-family: 'Public Sans', sans-serif;
    }
    .custom-range-picker-container {
        display: flex;
        flex-direction: row;
        min-width: 480px;
        border-radius: 8px;
        overflow: hidden;
    }
    .range-calendar {
        border-right: 1px solid #f0f0f0;
        padding: 12px 12px 12px 0;
        background: #fff;
    }
    .range-header-col {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 8px;
        align-items: flex-start;
        width: 100%;
    }

    .date-value {
        font-size: 14px;
        color: var(--color-text-heading);
        font-weight: 500;
        border: 1px solid var(--color-captcha-box);
        padding: 6px 16px;
        border-radius: 6px;
        width: 100%;
        text-align: left;
        box-shadow: 0px 1px 2px 0px #1018280D;
    }

    .range-sidebar {
        min-width: 160px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 14px 10px;
        background: #fff;
    }
    .range-header {
        display: flex;
        flex-direction: column;
        margin-bottom: 12px;
    }
    .range-footer {
        display: flex;
        gap: 8px;
        flex-direction: column;
        justify-content: flex-end;
        margin-top: 20px;
    }
    .report-date-input {
      display: flex;
        align-items: center;
        flex-direction: row;
        justify-content: space-between;  /* pushes text left and icon right */
        border: 1px solid var(--color-secondary-grey-container);
        border-radius: 8px;
        padding: 0 16px;                 /* horizontal padding for balance */
        height: 50px;
        font-size: 14px;
        cursor: pointer;
        background-color: white;
        color: #333;
        gap: 0;               
        box-sizing: border-box;
        transition: border-color 0.3s;
    }

    .report-date-input.active-report {
        border-color: var(--color-accent) !important;
        color: var(--color-accent);
    }

    .report-date-placeholder {
        flex: 1;
        color: inherit;
    }

    .report-date-icon {
        width: 20px;
        height: 20px;
        margin-left: 12px;
    }


    .form-title {
        color: var(--color-primary);
        font-weight: 600;
        margin-bottom: 10px;
    }
    .popover-button {
        width: 100%;
        text-transform: capitalize;
    }
      .form-field  .mud-input,
      .form-field  .mud-select {
        width: 100%;
        background-color: white !important;
        color: var(--color-text-heading);   
    }
    .image-upload {
        width: 20px;
        height: 20px;
        margin-right: 8px;
    }
    .download-btn {
        text-transform: capitalize;
        margin-top: 12px;
        font-weight: 500;
    }

    .disabled-field {
        background-color: #F4F6F8;
    }

    .active-icon {
        filter: brightness(0) saturate(100%) invert(54%) sepia(98%) saturate(670%) hue-rotate(340deg) brightness(105%) contrast(102%);
    }

</style>
