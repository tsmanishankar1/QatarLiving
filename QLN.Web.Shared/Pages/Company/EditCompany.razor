@page "/qln/dashboard/company/edit/{id}"

@using QLN.Web.Shared.Components.BreadCrumb
@using QLN.Web.Shared.Components.EmptyCard
@using MudExRichTextEditor
@inherits EditCompanyBase

<div style=" background-color: #F2F4F7; height: 100%;width:100%;padding: 24px;">
    <div Class=" mt-1 ml-10">
        <Breadcrumb Items="breadcrumbItems" />

    </div>

    @if (isCompanyLoading)
    {
        <div class="p-6">
            <!-- Breadcrumb Skeleton -->
            <MudSkeleton Width="30%" Height="24px" Animation="Animation.Pulse" Class="mb-4" />

            <MudPaper Class="d-flex pa-4" Style="gap: 24px;">
                <!-- Left-side Image Skeleton -->
                <div style="width: 180px; height: 180px;">
                    <MudSkeleton Variant="Variant.Circular" Width="180px" Height="180px" Animation="Animation.Pulse" />
                </div>

                <!-- Right-side Form Skeleton -->
                <div class="flex-grow-1">
                    <MudStack Spacing="2">
                        @for (int i = 0; i < 10; i++)
                        {
                            <MudSkeleton Width="80%" Height="32px" />
                        }
                    </MudStack>
                </div>
            </MudPaper>
        </div>
    }


    else if (companyProfile != null)
    {
        <MudContainer Class="company-profile-container">
            <MudGrid GutterSize="24px" class="ml-3 mt-4">
             

                <!-- Logo Upload -->
                <MudItem xs="12" md="3" Class="company-profile-logo-container">
                    <!-- Contact Information -->

                    <MudText Class="heading-style mt-2 ml-14">Contact Information</MudText>

                    <MudFileUpload T="IBrowserFile" Accept="image/*" FilesChanged="OnLogoFileSelected" MaxFileSize="10485760">
                        <ActivatorContent>
                            <MudPaper Elevation="1"
                                      Class="d-flex flex-column align-center justify-center mt-4 p-2"
                                      Style="height: 240px; width:240px; border: 2px dashed #ccc; cursor: pointer;">
                                @if (!string.IsNullOrEmpty(_localLogoBase64))
                                {
                                    <img src="@($"data:image/*;base64,{_localLogoBase64}")"
                                         alt="Company Logo"
                                         style="max-height: 100%; max-width: 100%; object-fit: contain;" />

                                    <div style="position: absolute; bottom: 0; color:white; width:240px; height: 24px; background-color: #000000CC; display: flex; justify-content: center; align-items: center; gap: 8px;">
                                        <MudIconButton Icon="@Icons.Material.Outlined.Edit"
                                                       Style="color: white; padding: 0;" />
                                        <MudIconButton Icon="@Icons.Material.Outlined.Delete"
                                                       Style="color: white; padding: 0;"
                                                       OnClick="ClearLogo" />
                                    </div>
                                }
                                else if (!string.IsNullOrEmpty(companyProfile.CompanyLogo))
                                {
                                    <img src="@companyProfile.CompanyLogo"
                                         alt="Company Logo"
                                         style="max-height: 100%; max-width: 100%; object-fit: contain;" />

                                    <div style="position: absolute; bottom: 0; color:white; width:240px; height: 24px; background-color: #000000CC; display: flex; justify-content: center; align-items: center; gap: 8px;">
                                        <MudIconButton Icon="@Icons.Material.Outlined.Edit"
                                                       Style="color: white; padding: 0;" />
                                        <MudIconButton Icon="@Icons.Material.Outlined.Delete"
                                                       Style="color: white; padding: 0;"
                                                       OnClick="ClearLogo" />
                                    </div>
                                }
                                else
                                {
                                    <div style="width: 64px; height: 64px; background-color: #E0E0E0; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                        <img src="/qln-images/Upload.svg" alt="Upload" style="height: 48px;" />
                                    </div>
                                    <MudText style="margin-top: 8px; color: #FF7F38; font-size: 14px; font-weight: 500;">Upload image</MudText>
                                }

                            </MudPaper>
                        </ActivatorContent>
                    </MudFileUpload>



                    <MudText Typo="Typo.caption" Class="mt-1">Recommended size: 1920×1200, Max: 10MB</MudText>
                </MudItem>



                <MudItem xs="12" md="9" Class="company-profile-form-section">
                    <EditForm Model="@companyProfile" OnValidSubmit="SaveCompanyProfileAsync">
                        <DataAnnotationsValidator />

                        <MudTextField id="businessName" @bind-Value="companyProfile.BusinessName" Label="Business Name" Required="true" Class="form-input no-underline" Immediate="true"
                                      For="@(() => companyProfile.BusinessName)" />
                        <ValidationMessage For="@(() => companyProfile.BusinessName)" />

                        <MudSelect T="string"
                                   Label="Country *"
                                   Value="companyProfile.Country"
                                   ValueChanged="OnCountryChanged"
                                   Class="select-input no-underline"
                                   Immediate="true">
                            @foreach (var item in CountryCityList)
                            {
                                <MudSelectItem Value="@item.Country">@item.Country</MudSelectItem>
                            }
                        </MudSelect>
                        <ValidationMessage For="@(() => companyProfile.Country)" />

                        <MudSelect T="string"
                                   Label="City *"
                                   @bind-Value="companyProfile.City"
                                   Class="select-input no-underline"
                                   Immediate="true"
                                   Disabled="@(!AvailableCities.Any())">
                            @foreach (var city in AvailableCities)
                            {
                                <MudSelectItem Value="@city">@city</MudSelectItem>
                            }
                        </MudSelect>
                        <ValidationMessage For="@(() => companyProfile.City)" />


                    <MudTextField @bind-Value="companyProfile.BranchLocations[0]" Label="Branches" Class="form-input no-underline" Adornment="Adornment.End" AdornmentIcon="@Icons.Material.Filled.LocationOn" />

                        <MudTextField @bind-Value="companyProfile.PhoneNumber" Label="Phone Number" For="@(() => companyProfile.PhoneNumber)" Class="form-input no-underline" Adornment="Adornment.Start" AdornmentText="@companyProfile.PhoneNumberCountryCode" Immediate="true" />
                        <ValidationMessage For="@(() => companyProfile.PhoneNumber)" />

                        <MudTextField @bind-Value="companyProfile.WhatsAppNumber" Label="WhatsApp Number"  For="@(() => companyProfile.WhatsAppNumber)" Class="form-input no-underline" Adornment="Adornment.Start" AdornmentText="@companyProfile.WhatsAppCountryCode" Immediate="true" />
                        <ValidationMessage For="@(() => companyProfile.WhatsAppNumber)" />

                        <MudTextField @bind-Value="companyProfile.Email" For="@(() => companyProfile.Email)" Label="Email" Class="form-input no-underline" Immediate="true" />
                        <ValidationMessage For="@(() => companyProfile.Email)" />

                    <MudTextField @bind-Value="companyProfile.WebsiteUrl" Label="Website URL"  For="@(() => companyProfile.WebsiteUrl)" Class="form-input no-underline" Immediate="true" />
                        <ValidationMessage For="@(() => companyProfile.WebsiteUrl)" />

                    <MudTextField @bind-Value="companyProfile.FacebookUrl" Label="Facebook URL" For="@(() => companyProfile.FacebookUrl)" Class="form-input no-underline " Immediate="true"  />
                        <ValidationMessage For="@(() => companyProfile.FacebookUrl)" />

                        <MudTextField @bind-Value="companyProfile.InstagramUrl" Label="Instagram URL" For="@(() => companyProfile.InstagramUrl)" Class="form-input no-underline" Immediate="true" />
                        <ValidationMessage For="@(() => companyProfile.InstagramUrl)" />

                    <!-- Operating Hours -->

                    <MudText Typo="Typo.h6" Class="section-header">Operating Hours</MudText>

                    <MudGrid class="grid-flex">
                        <div class="row-flex">
                            <MudSelect T="string" Label="Start Day *"
                                       @bind-Value="companyProfile.StartDay"
                                       Class="select-input no-underline"
                                       Immediate="true">
                                @foreach (var day in Enum.GetValues<DaysOfWeek>())
                                {
                                    <MudSelectItem T="string" Value="@day.ToString()">@day</MudSelectItem>
                                }
                            </MudSelect>

                            <MudSelect T="string" Label="End Day *"
                                       @bind-Value="companyProfile.EndDay"
                                       Class="select-input no-underline"
                                       Immediate="true">
                                @foreach (var day in Enum.GetValues<DaysOfWeek>())
                                {
                                    <MudSelectItem T="string" Value="@day.ToString()">@day</MudSelectItem>
                                }
                            </MudSelect>
                        
                        </div>
                        <div class="row-flex">

                            <MudTimePicker @bind-Time="companyProfile.StartHour"
                                           Label="Start Hour"
                                           Class="grid-input no-underline"
                                           Adornment="Adornment.End"
                                           AdornmentIcon="@Icons.Material.Outlined.AccessTime" />

                            <MudTimePicker @bind-Time="companyProfile.EndHour"
                                           Label="End Hour"
                                           Class="grid-input no-underline"
                                           Adornment="Adornment.End"
                                           AdornmentIcon="@Icons.Material.Outlined.AccessTime" />

                        </div>
                    </MudGrid>

                    <!-- Company Profile -->
                    <MudText Typo="Typo.h6" Class="heading-style">Company Profile</MudText>
                    <MudSelect T="int"
                               Label="Nature of Business *"
                               SelectedValues="@companyProfile.NatureOfBusiness"
                               SelectedValuesChanged="@((IEnumerable<int> values) => { companyProfile.NatureOfBusiness = values.ToList(); })"
                               MultiSelection="true"
                               ToStringFunc="@(value => GetDisplayName((NatureOfBusiness)value))"
                               Class="select-input no-underline">
                        @foreach (var item in Enum.GetValues<NatureOfBusiness>())
                        {
                            <MudSelectItem Value="@(Convert.ToInt32(item))">@GetDisplayName(item)</MudSelectItem>
                        }
                    </MudSelect>


                    <MudSelect T="int" Label="Company Size*" @bind-Value="companyProfile.CompanySize" Class="select-input no-underline">
                        @foreach (var item in Enum.GetValues<CompanySize>())
                        {
                            <MudSelectItem T="int" Value="@(Convert.ToInt32(item))">@GetDisplayName(item)</MudSelectItem>
                        }
                    </MudSelect>

                    <MudSelect T="int" Label="Company Type*" @bind-Value="companyProfile.CompanyType" Class="select-input no-underline">
                        @foreach (var item in Enum.GetValues<CompanyType>())
                        {
                            <MudSelectItem T="int" Value="@(Convert.ToInt32(item))">@GetDisplayName(item)</MudSelectItem>
                        }
                    </MudSelect>

                    <MudTextField @bind-Value="companyProfile.UserDesignation" Label="User Designation" Class="description-input no-underline" />
                    @*                     <MudTextField T="string" Label="Business Description" @bind-Value="companyProfile.BusinessDescription" Lines="5" Class="description-input no-underline" />
 *@                    

                <MudExRichTextEdit @bind-Value="companyProfile.BusinessDescription"
                                       Height="300"
                                       Class="description-input no-underline"
                                       Placeholder="Write your business description..." />
                    @*  @if (!string.IsNullOrWhiteSpace(companyProfile?.BusinessDescription))
                    {
                        <div class="mt-4" style="border: 1px solid #D0D5DD; padding: 16px;">
                            <h6>Preview:</h6>
                            @((MarkupString)companyProfile.BusinessDescription)
                        </div>
                    } *@
                    <!-- License & Visibility -->
                    <MudText Typo="Typo.h6" Class="heading-style">License & Visibility</MudText>

                    <MudTextField T="int" @bind-Value="companyProfile.CrNumber" Label="CR Number" Class="form-input no-underline" Immediate="true" />
                                        <ValidationMessage For="@(() => companyProfile.CrNumber)" />

                    <MudPaper Class="d-flex align-center mt-2 p-2 doc-input no-underline">
                        <MudText Typo="Typo.body1">
                            CR Document*
                            @if (!string.IsNullOrEmpty(crDocumentBase64))
                            {
                                @*           <a href="@($"data:application/pdf;base64,{crDocumentBase64}")" target="_blank">
                                    <MudText Typo="Typo.caption" Class="ml-2">@crFileName</MudText>
                                                             </a> *@

                                <MudText Typo="Typo.caption" Class="ml-2">@crFileName</MudText>
                                <MudIconButton Icon="@Icons.Material.Outlined.Close"
                                               Size="Size.Small"
                                               Color="Color.Error"
                                               OnClick="ClearCrFile" />
                            }

                        </MudText>
                        <MudSpacer />

                        <MudFileUpload T="IBrowserFile" Accept=".pdf,.png,.jpg,.jpeg"
                                       MaxFileSize="10485760" FilesChanged="OnCrFileSelected">
                            <ActivatorContent>
                                <MudButton Variant="Variant.Filled"
                                           Color="Color.Primary"
                                           EndIcon="@Icons.Material.Outlined.CloudUpload"
                                           Class="upload-button">
                                    Upload
                                </MudButton>
                            </ActivatorContent>
                        </MudFileUpload>


                    </MudPaper>

                    <MudText Typo="Typo.caption">Supported file formats: PDF, PNG, JPG. Max: 10MB</MudText>
                    <!-- Save Button -->
                    <MudItem xs="12" Class="mt-4 button-container">
                            <MudButton Variant="Variant.Filled"
                                       Color="Color.Primary"
                                       Style="width:100%"
                                       Disabled="@isSaving"
                                       Loading="@isSaving"
                                       ButtonType="ButtonType.Submit">
                            Save
                        </MudButton>
                    </MudItem>
                   </EditForm>
                </MudItem>


            </MudGrid>
        </MudContainer>
    }

    else
    {
        <EmptyCard Title="Company Profile Not Found" Subtitle="The company profile you are trying to edit does not exist." />
    }
</div>

<style>

    .heading-style {
        font-family: 'Public Sans', sans-serif;
        font-weight: 600;
        font-size: 18px;
        line-height: 26px;
        color: #00426D;
        margin-top: 14px;
    }

    .company-profile-container {
        background-color: #F2F4F7;
    }

    .form-input {
        justify-content: center;
        width: 472px;
        height: 60px;
        margin-top: 14px;
        background-color: #FFFFFF;
        border-radius: 6px;
        padding: 10px;
        position: relative;
        border: 1px solid #D0D5DD;
    }

    .select-input {
        justify-content: center;
        margin-top: 14px;
        background-color: #FFFFFF;
        border-radius: 6px;
        padding: 10px;
        position: relative;
        border: 1px solid #D0D5DD;
    }

    .doc-input {
        justify-content: center;
        max-width: 472px;
        height: 60px;
        margin-top: 14px;
        background-color: #FFFFFF;
        border-radius: 6px;
        padding: 10px;
        position: relative;
        border: 1px solid #D0D5DD;
    }

    .mud-select {
        display: flex;
        flex-grow: 1;
        position: relative;
        max-width: 472px !important;
    }

    .description-input {
        justify-content: center;
        max-width: 472px;
        margin-top: 14px;
        background-color: #FFFFFF;
        border-radius: 6px;
        padding: 10px;
        position: relative;
        border: 1px solid #D0D5DD;
    }

    .grid-flex {
        display: flex;
        gap: 10px;
        flex-direction: column;
        margin-top: 10px;
        margin-left: 10px;
        width: 472px;
    }

    .row-flex {
        display: flex;
        gap: 10px;
        width: 100%;
        flex-direction: row;
        justify-content: space-between;
    }

    .grid-input {
        width: 232px !important;
        background-color: #FFFFFF;
        padding: 0px 10px;
        margin-top: 10px;
        height: 60px;
        border: 1px solid #D0D5DD;
    }

    .upload-subtitle {
        color: #9E9E9E;
        text-align: center;
        margin-top: 8px;
    }

    .grid-input .mud-input-slot {
        border-bottom: none !important;
    }

    .section-header {
        font-weight: 600;
        font-size: 1.125rem;
        margin: 1.5rem 0 0.75rem 0;
        color: #333;
    }

    .upload-button {
        border-radius: 12px;
        text-transform: none;
    }

    .button-container {
        max-width: 472px;
    }


    .no-underline .mud-input-underline::before,
    .no-underline .mud-input-underline::after {
        border-bottom: none !important;
    }

    @@media (max-width: 600px) {
        .company-profile-container {
            justify-content: center;
            align-items: center;
            display: flex;
            padding: 10px 8px;
        }

        .company-profile-logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .grid-flex {
            display: flex;
            gap: 10px;
            flex-direction: column;
            margin-top: 10px;
            margin-left: 10px;
            width: auto;
        }

        .row-flex {
            flex-direction: column;
            display: flex;
            gap: 10px;
            width: auto;
        }

        .doc-input {
            justify-content: center;
            height: 60px;
            margin-top: 14px;
            background-color: #FFFFFF;
            border-radius: 6px;
            padding: 10px;
            position: relative;
            border: 1px solid #D0D5DD;
        }

        .grid-input {
            width: 100% !important;
            background-color: #FFFFFF;
            padding: 0px 10px;
            margin-top: 10px;
            height: 60px;
            border: 1px solid #D0D5DD;
        }
    }

    @@media (min-width: 601px) and (max-width: 1110px) {
        .company-profile-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 8px;
        }

        .company-profile-logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .company-profile-form-section {
            justify-content: center;
            display: flex;
        }

        .grid-flex {
            display: flex;
            gap: 10px;
            flex-direction: column;
            margin-top: 10px;
            margin-left: 10px;
            max-width: auto !important;
        }

        .row-flex {
            flex-direction: column;
            display: flex;
            gap: 10px;
            width: auto;
        }

        .doc-input {
            justify-content: center;
            height: 60px;
            margin-top: 14px;
            background-color: #FFFFFF;
            border-radius: 6px;
            padding: 10px;
            position: relative;
            border: 1px solid #D0D5DD;
        }

        .grid-input {
            width: 100% !important;
            background-color: #FFFFFF;
            padding: 0px 10px;
            margin-top: 10px;
            height: 60px;
            border: 1px solid #D0D5DD;
        }
    }

    }
</style>