@using Microsoft.Extensions.Options
@using QLN.ContentBO.WebUI.Components
@using QLN.ContentBO.WebUI.Handlers
@using QLN.ContentBO.WebUI.Models
@inherits QLComponentBase

@code
{
    protected async override Task OnInitializedAsync()
    {
        var destination = new Uri(NavManager.Uri).AbsolutePath.Substring(1);
        if (string.IsNullOrEmpty(destination))
        {
            destination = "dashboard";
        }

        if (IsLoggedIn)
        {
            return;
        }

        if (!string.IsNullOrWhiteSpace(CurrentUserName))
        {
            IsLoggedIn = true;
        }
        else
        {
            IsLoggedIn = false;

            if (NavigationPath.Value.IsLocal)
            {
                NavManager.NavigateTo($"{NavigationPath.Value.Login}?destination={destination}", forceLoad: true);
            }
            else
            {
                NavManager.NavigateTo($"{NavigationPath.Value.Login}?destination={NavigationPath.Value.BORedirectPrefix}{destination}", forceLoad: true);
            }
        }
    }
}