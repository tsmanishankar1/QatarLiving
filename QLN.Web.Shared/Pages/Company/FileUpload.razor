@page "/image-upload"
@using Microsoft.AspNetCore.Components.Forms

<h3>Select and Display Image</h3>

<InputFile OnChange="onImageSelected" accept="image/*" />

@if (!string.IsNullOrEmpty(imagePreviewUrl))
{
    <div class="mt-3">
        <img src="@imagePreviewUrl" alt="Preview" style="max-width: 200px; max-height: 200px;" />
    </div>
}

@if (!string.IsNullOrEmpty(base64Image))
{
    <p class="mt-3">Base64 (first 100 chars):</p>
    <code>@base64Image.Substring(0, 100)...</code>
}



<h3>Select and Upload File</h3>

<InputFile OnChange="OnFileSelected" accept=".pdf,.doc,.docx,.txt,.png,.jpg" />

@if (!string.IsNullOrEmpty(fileName))
{
    <p class="mt-2">Selected file: <strong>@fileName</strong></p>
}

@if (!string.IsNullOrEmpty(base64File))
{
    <p class="mt-3">Base64 (first 100 chars):</p>
    <code>@base64File.Substring(0, 100)...</code>
}

@code {
    private string imagePreviewUrl = string.Empty;
    private string base64Image = string.Empty;

    private async Task onImageSelected(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file != null && file.ContentType.StartsWith("image/"))
        {
            var buffer = new byte[file.Size];
            await file.OpenReadStream(maxAllowedSize: 10 * 1024 * 1024).ReadAsync(buffer);

            base64Image = Convert.ToBase64String(buffer);
            imagePreviewUrl = $"data:{file.ContentType};base64,{base64Image}";
        }
    }
    private string fileName = string.Empty;
    private string base64File = string.Empty;

    private async Task OnFileSelected(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file != null)
        {
            fileName = file.Name;

            if (file.Size > 10 * 1024 * 1024)
            {
                base64File = "File is too large. Max allowed size is 10MB.";
                return;
            }

            using var memoryStream = new MemoryStream();
            await file.OpenReadStream(maxAllowedSize: 10 * 1024 * 1024).CopyToAsync(memoryStream);
            base64File = Convert.ToBase64String(memoryStream.ToArray());
        }
    }
}
