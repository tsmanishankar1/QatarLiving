@using MudBlazor
@using QLN.Web.Shared.Components.Classifieds.StoreCard

<div class="store-carousel-wrapper">
    <h3 class="carousel-title">Discover amazing deals from the best stores in Qatar</h3>

    <div class="carousel-container">
        <MudIconButton Icon="@Icons.Material.Filled.ChevronLeft"
                       OnClick="@PrevSlide"
                       Disabled="@IsFirstSlide"
                       Class="custom-arrow-button1 left" />

        <div class="carousel-viewport-store">
            <div class="carousel-track" style="transform:@TrackOffset">
                @foreach (var store in stores)
                {
                    <StoreCard StoreData="store" OnShopNow="HandleShopNow" />
                }
            </div>
        </div>

        <MudIconButton Icon="@Icons.Material.Filled.ChevronRight"
                       OnClick="@NextSlide"
                       Disabled="@IsLastSlide"
                       Class="custom-arrow-button1 right" />
    </div>
</div>

@code {
   private List<StoreCard.StoreItem> stores = new()
    {
        new() { Name = "AIRBNB", LogoUrl = "images/stores/vector.svg", ItemCount = "2,152" },
        new() { Name = "Starlink", LogoUrl = "images/stores/starlink.svg", ItemCount = "2,152" },
        new() { Name = "MICROSOFT", LogoUrl = "images/stores/microsoft.svg", ItemCount = "2,152" },
        new() { Name = "Lulu Hypermarket", LogoUrl = "images/stores/hypermarket.svg", ItemCount = "2,152" },
        new() { Name = "City Hypermarket", LogoUrl = "images/stores/hypermarket_city.svg", ItemCount = "1,845" },
        new() { Name = "Al Meera", LogoUrl = "images/stores/meera.svg", ItemCount = "3,021" },
        new() { Name = "MICROSOFT", LogoUrl = "images/stores/microsoft.svg", ItemCount = "2,152" },
        new() { Name = "Lulu Hypermarket", LogoUrl = "images/stores/hypermarket.svg", ItemCount = "2,152" },
        new() { Name = "AIRBNB", LogoUrl = "images/stores/vector.svg", ItemCount = "2,152" },
        new() { Name = "Starlink", LogoUrl = "images/stores/starlink.svg", ItemCount = "2,152" },
        new() { Name = "Al Meera", LogoUrl = "images/stores/meera.svg", ItemCount = "3,021" },
        new() { Name = "MICROSOFT", LogoUrl = "images/stores/microsoft.svg", ItemCount = "2,152" }
    };
    private int groupIndex = 0;
    private int itemsPerGroup = 6;
    private int cardWidthPx = 170 + 16;

    private int TotalGroups => (int)Math.Ceiling((double)stores.Count / itemsPerGroup);

    private void NextSlide()
    {
        if (groupIndex < TotalGroups - 1)
            groupIndex++;
    }

    private void PrevSlide()
    {
        if (groupIndex > 0)
            groupIndex--;
    }

    private string TrackOffset => $"translateX(-{groupIndex * cardWidthPx * itemsPerGroup}px)";
    private bool IsFirstSlide => groupIndex == 0;
    private bool IsLastSlide => groupIndex >= TotalGroups - 1;

   private void HandleShopNow(StoreCard.StoreItem store)
    {
        Console.WriteLine($"Shop Now clicked for {store.Name}");
    }
}

<style>
.store-carousel-wrapper {
    padding: 2rem 1rem;
    position: relative;
    text-align: center;
    font-family: 'Public Sans', sans-serif;
}

.carousel-title {
    font-weight: 600;
    font-size: 25px;
    color: var(--color-text-heading);
    margin-bottom: 1.5rem;
    text-align: center;
}

.carousel-container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.carousel-viewport-store {
    overflow: hidden;
    width: 100%; /* 6 cards * (200 + 16)px */
    padding: 0 1rem
}

.carousel-track {
    display: flex;
    padding: 5px;
    transition: transform 0.5s ease-in-out;
    width: fit-content;
}

.custom-arrow-button1 {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    background:  var(--color-background);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.custom-arrow-button1.left {
    left: -20px;
}

.custom-arrow-button1.right {
    right: -20px;
}

@@media (max-width: 768px) {
    .custom-arrow-button1 {
        display: none;
    }

    .carousel-viewport {
        overflow-x: auto;
        scroll-behavior: smooth;
        width: 100%;
    }

    .carousel-track {
        transform: none !important;
        width: max-content;
    }

    .store-card {
        width: 100px;
        margin-right: 12px;
    }
}
</style>
