@page "/qln/classified/dashboard/items"
@inherits ItemDashboardBase
@using MudBlazor
@using QLN.Web.Shared.Components.BreadCrumb
@using QLN.Web.Shared.Components.EmptyCard

<div>
    <MudContainer MaxWidth="MaxWidth.Large" Class="dashboard-container">
        <Breadcrumb Items="breadcrumbItems" />

        <div class="dashboard-option">
            <span class="dashboard-text">Dashboard: Items</span>
            <MudIcon Icon="@Icons.Material.Filled.ArrowDropDown" Class="dropdown-icon" />
        </div>

        <div class="dashboard-title-container">
            <MudText class="dashboard-title">
                Items Dashboard
            </MudText>
        </div>
        <!-- Your dashboard content would go here -->
        <MudPaper Class="p-4 rounded-xl dashboard-statistics-container">

            @if (_businessProfile is not null)
            {
                <MudPaper Class="p-4 dashboard-company-container">

                    <img src="@_businessProfile.LogoUrl" alt="Logo" class="dashboard-company-logo" />
                    <MudText Typo="Typo.h6" Class="mt-2" Style="color:#004F9A; font-weight: bold;">
                        @_businessProfile.Name
                    </MudText>
                    <MudText Typo="Typo.body2" Style="color: #5F6C7B;">
                        @_businessProfile.CategoryName -
                        @_businessProfile.Duration
                    </MudText>
                    <MudText Typo="Typo.caption" Class="mt-1" Style="color: #5F6C7B;">Valid from</MudText>
                    <MudText Typo="Typo.caption" Style="color: #5F6C7B;">
                        @DateTime.Parse(_businessProfile.ValidFrom).ToString("MMM dd, yyyy") to
                        @DateTime.Parse(_businessProfile.ValidTo).ToString("MMM dd, yyyy")
                    </MudText>
                    <MudButton Variant="Variant.Outlined" Class="font-semibold mt-3 dashboard-edit-profile-button"
                               OnClick="@NavigateToEditProfile">
                        Edit Profile
                    </MudButton>
                </MudPaper>
            }


            <!-- Summary Cards -->
            <div class="statistics-content">
                <div class="statistics-header">
                    <MudText Typo="Typo.caption" Class="dashboard-statistics-title">Summary & Statistics</MudText>

                    <div style="display: flex; align-items: center; gap: 8px; border: 1px solid #FF7F38; border-radius: 6px; padding: 8px 12px; width: fit-content;">
                        <img src="/qln-images/subscription/Download.svg" alt="Download" style="width: 24px;" />
                        <span style="font-family: 'Public Sans', sans-serif; font-weight: 500; font-size: 14px; line-height: 22px; color: #FF7F38;">
                            Download Report
                        </span>
                    </div>


                </div>

                @if (_isLoading)
                {
                    <div class="d-flex justify-content-center mt-5">
                        <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Large" />
                    </div>
                }
                else if (!string.IsNullOrEmpty(_errorMessage))
                {
                    <EmptyCard Title="Subscription statistics not found for you account " Subtitle="Please check back later for updates." />
                }
                else if (stats != null && stats.Any())
                {
                    <MudGrid Class="mt-3">
                        @foreach (var stat in stats)
                        {
                            <MudItem xs="6" sm="4" md="3" Class="stat-item">
                                <MudPaper Class="p-3 d-flex align-items-center stat-paper"
                                          Style="justify-content:center;align-items:center;gap: 20px; border-radius: 12px;height:100px; background-color: #F9FAFB;">
                                    <img src="/qln-images/subscription/@stat.Icon" class="stat-icon" />
                                    <div class="stat-content">
                                        <MudText Typo="Typo.caption"
                                                 Class="stat-title">
                                            @stat.Title
                                        </MudText>
                                        <MudText Typo="Typo.subtitle2"
                                                 Class="stat-value">
                                            @stat.Value
                                        </MudText>
                                    </div>
                                </MudPaper>
                            </MudItem>
                        }
                    </MudGrid>
                }
                else
                {
                    <EmptyCard Title="Subscription statistics not found for you account " Subtitle="Please check back later for updates." />
                }

            </div>
        </MudPaper>

        <div class="my-ad-section">

            <!-- Left side: 20% width tabs -->
            <div class="my-ad-toolbar-section">
                <div class="tabs-toolbar">
                    <div class="tab @( _activeTabIndex == 0 ? "active" : "" )" @onclick="() => SetTab(0)">
                        <div style="display: flex; flex-direction: row; gap: 10px;">
                            <span class="tab-text">My Ads</span>
                        </div>
                        <div class="tab-indicator"></div>
                    </div>
                </div>
            </div>

            <!-- Right side: Post Add button -->
            <div>
                <MudButton Variant="Variant.Filled" Class="font-semibold mt-3" OnClick="@NavigateToAdPost"
                           Style="border-radius: 8px; background-color: #F26D1E; color: white; width: 200px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <MudIcon Icon="@Icons.Material.Filled.Add" />
                    Post Add
                </MudButton>
            </div>

        </div>

        <!-- My Ads Section -->
        <MudPaper Class="mt-4 p-5 rounded-xl" Style="background-color: white; box-shadow: none;padding:40px">


            <!-- Tabs + Search/Sort -->
            <div class="d-flex flex-column flex-sm-row mb-4" style="border-bottom: 1px solid #EAECF0;">
                <!-- First Row (Tabs) -->
                <div class="d-flex">
                    <!-- Published Tab (active style) -->
                    <MudButton Variant="Variant.Text" Class="@(_selectedAdsTab == 0 ? "active-tab" : "")"
                               Style="text-transform: none; font-weight: 600; padding-bottom: 12px; margin-right: 24px; position: relative;"
                               @onclick="() => _selectedAdsTab = 0">
                        Published (@publishedAds.Count)
                        @if (_selectedAdsTab == 0)
                        {
                            <div style="position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background-color: #F26D1E;">
                            </div>
                        }
                    </MudButton>
                    <!-- Unpublished Tab -->
                    <MudButton Variant="Variant.Text" Class="@(_selectedAdsTab == 1 ? "active-tab" : "")"
                               Style="text-transform: none; font-weight: 600; padding-bottom: 12px; position: relative;"
                               @onclick="() => _selectedAdsTab = 1">
                        Unpublished (@unpublishedAds.Count)
                        @if (_selectedAdsTab == 1)
                        {
                            <div style="position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background-color: #F26D1E;">
                            </div>
                        }
                    </MudButton>
                </div>

                <!-- Second Row (Search/Sort) - will stack below tabs on mobile -->
                <div class="ml-sm-auto d-flex align-items-center mt-2 mt-sm-0">
                    <MudTextField T="string" Placeholder="Search" Adornment="Adornment.Start"
                                  AdornmentIcon="@Icons.Material.Filled.Search" HideSpinButtons="true" Class="mr-2"
                                  Style="width: 200px;" />
                    <MudButton Variant="Variant.Text" StartIcon="@Icons.Material.Filled.Sort"
                               Style="text-transform: none; color: #344054;">
                        Sort
                    </MudButton>
                </div>
            </div>

            <!-- Published Ads -->
            @foreach (var ad in publishedAds)
            {
                <MudPaper Class="ad-container d-flex flex-column flex-sm-row mt-4 "
                          Style="border-radius: 0; border: none; border-bottom: 1px solid #EAECF0; box-shadow: none;">
                    <!-- First Row (Image + Checkbox) - full width on mobile -->
                    <div class="d-flex align-items-center mb-3 mb-sm-0 mr-sm-4">
                        <MudCheckBox T="bool" @bind-Checked="_isChecked" Class="mr-2 ad-checkbox" />
                        <img src="/qln-images/subscription/Gucci.png" alt="Ad Image"
                             style="width: 240px; max-width:100%; height: auto; max-height: 180px; border-radius: 4px;" />
                    </div>

                    <!-- Second Column (Main Content) -->
                    <div style="flex:1">
                        <!-- Category (Row 2) -->
                        <MudText Typo="Typo.body2"
                                 Style="font-family: 'Public Sans', sans-serif; font-weight: 500; font-size: 11px; line-height: 12px; letter-spacing: 0; color: #646464; margin-bottom: 4px;">
                            @ad.Category
                        </MudText>

                        <!-- Title (Row 3) -->
                        <MudText Typo="Typo.h6"
                                 Style="font-family: 'Public Sans', sans-serif; font-weight: 500; font-size: 14px; line-height: 20px; letter-spacing: 0; color: #00426D; margin-bottom: 4px;">
                            @ad.Title
                        </MudText>

                        <!-- Certificate + Location (Row 4) -->
                        <div class="d-flex flex-column flex-sm-row align-items-sm-center mb-2">
                            <div class="d-flex align-items-center mb-2 mb-sm-0">
                                <MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Small" Color="Color.Primary"
                                         Style="margin-right:4px" />
                                <MudLink Href="#"
                                         Style="margin-left:4px;font-family: 'Public Sans', sans-serif; font-weight: 500; font-size: 12px; line-height: 18px; letter-spacing: 0; color: #0065A8;">
                                    Certificate.pdf
                                </MudLink>
                            </div>
                            <div class="d-flex align-items-center ml-2">
                                <MudIcon Icon="@Icons.Material.Outlined.Place" Size="Size.Small"
                                         Style="color: #646464; margin-left: 0; margin-sm-left:4px;" />
                                <MudText Typo="Typo.caption"
                                         Style="margin-left:4px;font-family: 'Public Sans', sans-serif; font-weight: 500; font-size: 11px; line-height: 12px; letter-spacing: 0; color: #646464;">
                                    @ad.Location
                                </MudText>
                            </div>
                        </div>

                        <!-- Price (Row 5) -->
                        <MudText Typo="Typo.h6"
                                 Style="font-family: 'Public Sans', sans-serif; font-weight: 600; font-size: 20px; line-height: 34px; letter-spacing: 0; color: #242424;">
                            @ad.Price @ad.PriceType
                        </MudText>

                        <!-- Buttons (Row 6) -->
                        <div class="d-flex flex-wrap mt-2" style="gap: 8px;">
                            <MudButton Variant="Variant.Text"
                                       Style="text-transform: none; background-color: #F5F6FA; border-radius: 4px; color: #242424; display: flex; align-items: center;">
                                <img src="qln-images/subscription/Refresh.svg" alt="Gucci" style="margin-right: 8px;" />
                                <div>
                                    Refresh
                                    <div style="font-size: 0.7em; color: #5F6C7B;">(Exp: @ad.ExpiryDate)</div>
                                </div>
                            </MudButton>

                            @if (ad.IsFeatured)
                            {
                                <MudButton Variant="Variant.Text"
                                           Style="text-transform: none;background-color:#F5F6FA;border-radius:4px; color: #242424;">
                                    <img src="qln-images/subscription/Feature.svg" style="margin-right: 8px;" alt="Feature" />
                                    Unfeature
                                </MudButton>
                            }
                            else
                            {
                                <MudButton Variant="Variant.Text"
                                           Style="text-transform: none;background-color:#F5F6FA;border-radius:4px; color: #242424;">
                                    <img src="qln-images/subscription/Feature.svg" style="margin-right: 8px;" alt="Feature" />
                                    Pay to Feature
                                </MudButton>
                            }
                            <MudButton Variant="Variant.Text"
                                       Style="text-transform: none;background-color:#F5F6FA;border-radius:4px; color: #242424;">
                                <img src="qln-images/subscription/Feature.svg" style="margin-right: 8px;" alt="Feature" />
                                Promote
                            </MudButton>
                            <MudIconButton Icon="@Icons.Material.Filled.MoreVert" />
                        </div>
                    </div>
                </MudPaper>

                <!-- Stats + Status -->
                <MudPaper Class="d-flex flex-column flex-sm-row align-items-sm-center px-4 py-2 mb-4"
                          Style="margin-top:10px;border-radius:0; border:none; border-bottom:1px solid #EAECF0; box-shadow:none;">
                    <!-- Stats -->
                    <div class="d-flex flex-wrap" style="flex: 1; gap: 16px;">
                        <div class="d-flex align-items-center" style="gap: 6px; color: #5F6C7B;">
                            <img src="qln-images/subscription/Impressions.svg" style="width: 16px; height: 16px; color: #00426D;" />
                            <MudText Typo="Typo.caption" Style="margin: 0;">Impressions: @ad.Impressions</MudText>
                        </div>
                        <div class="d-flex align-items-center" style="gap: 6px; color: #5F6C7B;">
                            <img src="qln-images/subscription/Views.svg" style="width: 16px; height: 16px; color: #00426D;" />
                            <MudText Typo="Typo.caption" Style="margin: 0;">Views: @ad.Views</MudText>
                        </div>
                        <div class="d-flex align-items-center" style="gap: 6px; color: #5F6C7B;">
                            <img src="qln-images/subscription/Calls.svg" style="width: 16px; height: 16px; color: #00426D;" />
                            <MudText Typo="Typo.caption" Style="margin: 0;">Calls: @ad.Calls</MudText>
                        </div>
                        <div class="d-flex align-items-center" style="gap: 6px; color: #5F6C7B;">
                            <img src="qln-images/subscription/WhatsApp.svg" style="width: 16px; height: 16px; color: #00426D;" />
                            <MudText Typo="Typo.caption" Style="margin: 0;">WhatsApp: @ad.WhatsAppClicks</MudText>
                        </div>
                        <div class="d-flex align-items-center" style="gap: 6px; color: #5F6C7B;">
                            <img src="qln-images/subscription/PromotedAds.svg" style="width: 16px; height: 16px; color: #00426D;" />
                            <MudText Typo="Typo.caption" Style="margin: 0;">Shares: @ad.Shares</MudText>
                        </div>
                        <div class="d-flex align-items-center" style="gap: 6px; color: #5F6C7B;">
                            <img src="qln-images/subscription/FeaturedAds.svg" style="width: 16px; height: 16px; color: #00426D;" />
                            <MudText Typo="Typo.caption" Style="margin: 0;">Saves: @ad.Saves</MudText>
                        </div>
                    </div>

                    <MudText Typo="Typo.caption" Class="mt-2 mt-sm-0" Style="color: #5F6C7B;">Listed on 01‑02‑2025</MudText>
                </MudPaper>
            }
        </MudPaper>


    </MudContainer>
</div>

<style>
    .dashboard-container {
        padding: 20px 40px;
        background-color: #F2F4F7;
    }

    .dashboard-option {
        display: flex;
        align-items: center;
        gap: 4px;
        margin-top: 16px;
        padding : 0px 20px;
    }

    .dashboard-text {
        font-family: 'Public Sans', sans-serif;
        font-weight: 500;
        font-size: 16px;
        line-height: 24px;
        color: #454545;
        vertical-align: middle;
    }

    .dropdown-icon {
        color: #454545;
        font-size: 24px;
    }

    .dashboard-title-container {
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
        margin-top: 24px;
    }

    .dashboard-title {
        font-family: 'Public Sans', sans-serif;
        font-weight: 600;
        font-size: 25px;
        line-height: 26px;
        color: #242424;
    }
    .dashboard-statistics-container {
        padding: 16px;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 16px;
        background-color: white;
        margin-top: 24px;
    }
    .dashboard-company-container{
        width: 260px;
        padding: 16px;
        display: flex;
        flex-direction: column;
        align-items: center;
        border-radius: 12px;
        background-color: #FAFAFA;
    }

    .dashboard-company-logo{
        width: 80px;
        height: 80px;
    }
    .dashboard-edit-profile-button{
        border-radius: 8px;
        border: 1px solid #F26D1E;
        background-color: white;
        color: #F26D1E;
        width: 200px;
    }

    .statistics-content {
        flex: 1;
        min-width: 0;
    }

   .statistics-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 16px;
    }

    .dashboard-statistics-title {
        font-family: 'Public Sans', sans-serif;
        font-weight: 600;
        font-size: 18px;
        line-height: 26px;
        letter-spacing: 0;
        vertical-align: middle;
        color: #242424;
    }

    .stat-paper {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        border-radius: 12px;
        height: 100px;
        background-color: #F9FAFB;
        padding: 16px;
    }

    .stat-icon {
        width: 24px;
        height: 24px;
    }

    .stat-title {
        font-family: 'Public Sans', sans-serif;
        font-weight: 600;
        font-size: 14px;
        line-height: 24px;
        color: #242424;
        margin-bottom: 4px;
    }

    .stat-value {
        font-family: 'Public Sans', sans-serif;
        font-weight: 500;
        font-size: 14px;
        color: #004F9A;
        text-align: center;
    }

    .my-ad-section{
        display: flex;
        width: 100%;
        margin-top: 40px;
        justify-content: space-between;
        align-items: center;
    }
    .my-ad-toolbar-section{
        width:20%
    }

    ad-container
    {
        padding:16px
    }

    @@media (max-width: 1007px) {
        .dashboard-container {
            padding-left: 0px;
            padding-right: 0px;
        }
    }


    @@media (max-width: 800px) {
        .dashboard-statistics-container {
            flex-direction: column;
        }

        .dashboard-company-container {
            width: 100%;
        }

        .statistics-content {
            width: 100%;
        }
    }

    @@media (min-width: 530px) and (max-width: 800px) {
        .stat-item {
            flex-basis: 50% !important;
            max-width: 50% !important;
        }
    }

    @@media (max-width: 600px) {
        .stat-item {
            padding: 8px !important;
        }

        .stat-paper {
            height: 90px;
            gap: 16px;
            padding: 12px;
        }
    }


    /* For screens 393px and below (mobile) */
    @@media (max-width: 393px) {
        .dashboard-container {
            padding-left: 0;
            padding-right: 0;
            padding-top: 16px;
            padding-bottom: 16px;
        }

        .stat-paper {
            flex-direction: column;
            height: auto;
            gap: 8px;
            padding: 16px 8px;
        }

        .stat-icon {
            margin-bottom: 8px;
        }

        .stat-title,
        .stat-value {
            text-align: center;
            font-size: 13px;
        }

        .my-ad-section {
            display: flex;
            flex-direction:row;
            width: 100%;
            margin-top: 20px;

        }

        .my-ad-toolbar-section {
            width: 100%
        }


        .d-flex.flex-column.flex-sm-row {
            flex-direction: column !important;
        }

        .ml-sm-auto {
            margin-left: 0 !important;
        }

        .mt-2.mt-sm-0 {
            margin-top: 8px !important;
        }

        .d-flex.flex-column.flex-sm-row {
            flex-direction: column !important;
        }

        .mb-3.mb-sm-0 {
            margin-bottom: 12px !important;
        }

        .mr-sm-4 {
            margin-right: 0 !important;
        }

        img {
            max-width: 100% !important;
            height: auto !important;
        }

        .d-flex.flex-wrap {
            gap: 8px !important;
        }
        /* Stats section */
        .d-flex.flex-column.flex-sm-row.align-items-sm-center {
            flex-direction: column !important;
            align-items: flex-start !important;
        }

        .mt-2.mt-sm-0 {
            margin-top: 8px !important;
        }

        .ad-checkbox {
            display: none !important;
        }

        .ad-container {
            padding: 0.5rem !important;
        }
    }
</style>